<div class="todo-item">
    <div class="todo-header">
        <div class="todo-title">
            {{ todo()?.title }}
        </div>
    </div>
    <div class="todo-body">
        <div class="todo-details">
            <div class="todo-status">
                <label for="status-select">Статус:</label>
                <select [formControl]="status" name="status" id="status-select">
                    <option value="to-do">To do</option>
                    <option value="in-progress">In progress</option>
                    <option value="done">Done</option>
                </select>
            </div>
            <div class="todo-priority">
                <label for="priority-select">Пріоритетність:</label>
                <select [formControl]="priority" name="priority" id="priority-select">
                    <option value="1">Low</option>
                    <option value="2">Normal</option>
                    <option value="3">High</option>
                    <option value="4">Highest</option>
                </select>
            </div>
            <div class="todo-assignee">
                <label for="assignee-select">Виконавець:</label>
                <select [formControl]="assignee" name="assignee" id="assignee-select">
                    <option value="null" disabled>Not assigned</option>
                    @for (member of members(); track member?.id) {
                        <option [value]="member?.id">{{ member?.metadata?.username }}</option>
                    }
                </select>
            </div>
            <div class="todo-due-date">
                <label for="dueDate">Дедлайн:</label>
                <input [formControl]="dueDate" type="date" id="dueDate" name="dueDate">
            </div>
        
            <div class="todo-footer">
                <div class="todo-author">
                    Створив: {{ todo()?.owner_metadata?.username }}
                </div>
                <div class="todo-creation_date">
                    {{ todo()?.created_at | date }}
                </div>
            </div>
            @if(todo()?.created_by === authService.currentUser()?.id) {
                <div class="custom-button" (click)="deleteItem()">Delete</div>
            }
        </div>

        <div class="todo-description">
            Опис: {{ todo()?.description }}
        </div>
    </div>
    <br>
    <div class="todo-comments">
        Коментарі

        <div class="add-comment">
            <label for="comment">Додати коментар:</label>
            <textarea [formControl]="newComment" id="comment" name="comment"></textarea>
            <input class="form-button" type="submit" value="Comment" (click)="addComment()">
        </div>

        <div class="task-comments">
            @for (comment of taskComments(); track comment.id) {
                <div class="comment-block">
                    @if(isEditMode && commentInEditingId === comment.id) {
                        <label for="edit-comment">Edit a comment:</label>
                        <textarea [formControl]="editComment" id="edit-comment" name="edit-comment"></textarea>
                        <input class="form-button" type="submit" value="Edit" (click)="onEditComment(comment.id)">
                        <input class="form-button" type="submit" value="Cancel" (click)="onCancelEdit()">
                    } @else {
                        <div class="comment-text">
                            {{ comment.comment }}
                        </div>
                        @if(comment.user_id === authService.currentUser()?.id) {
                            <div class="custom-button" (click)="edit(comment)">Edit</div>
                            <div class="custom-button" (click)="deleteComment(comment.id)">Delete</div>
                        }
                    }
                    <div class="created-at">{{ comment.created_at | date }}</div>
                    <div class="user">{{ comment.user_metadata.username }}</div>
                </div>
            }
        </div>
    </div>
</div>
